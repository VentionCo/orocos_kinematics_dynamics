<!doctype html>
<html>
  <script>
    var Module = {
      onRuntimeInitialized: () => {
        const {
          Chain,
          Segment,
          Joint,
          Frame,
          Vector,
          JointType,
          RotX,
          RotZ,
          ChainFkSolverPos_recursive,
          ChainIkSolverVel_pinv,
          ChainIkSolverPos_LMA,
          JntArray,
          getStdVectorFromJntArray
        } = Module

        const chain = new Chain()
        chain.addSegment(new Segment(new Joint(JointType.RotZ), new Frame(new Vector(0.0, 0.0, 1.020))))
        chain.addSegment(new Segment(new Joint(JointType.RotX), new Frame(new Vector(0.0, 0.0, 0.480))))
        chain.addSegment(new Segment(new Joint(JointType.RotX), new Frame(new Vector(0.0, 0.0, 0.645))))
        chain.addSegment(new Segment(new Joint(JointType.RotZ)))
        chain.addSegment(new Segment(new Joint(JointType.RotX), new Frame(new Vector(0.0, 0.0, 0.120))))
        chain.addSegment(new Segment(new Joint(JointType.RotZ)))

        const ikSolverPos = new ChainIkSolverPos_LMA(chain)
        
        const nrOfJoints = chain.getNrOfJoints()
        const q_init = new JntArray(nrOfJoints)
        const pos_goal = new Frame(new Vector(0.0, 1.0, 1.0))
        const q_sol = new JntArray(nrOfJoints)

        const result = ikSolverPos.CartToJnt(q_init, pos_goal, q_sol)

        if (result !== 0) {
          console.log("ERROR")
        }

        const data = getStdVectorFromJntArray(q_sol)
        for (let i = 0; i < data.size(); i++) {
          console.log(data.get(i))
        }
        // https://github.com/orocos/orocos_kinematics_dynamics/blob/00b7533abc1391785fbafc9a8e0ed7301516b892/orocos_kdl/examples/chainiksolverpos_lma_demo.cpp#L90-L10
      }
    }
  </script>
  <script src="wasm.js"></script>
</html>